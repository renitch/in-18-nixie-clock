###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V5.50.0.51878/W32 for ARM     14/Mar/2021  19:14:53 #
# Copyright (C) 1999-2010 IAR Systems AB.                                     #
#                                                                             #
#    Cpu mode     =  arm                                                      #
#    Endian       =  little                                                   #
#    Source file  =  C:\Projects\in-18-nixie-clock\at91sam7s-ek\usb-device-cd #
#                    c-serial-project\main.c                                  #
#    Command line =  C:\Projects\in-18-nixie-clock\at91sam7s-ek\usb-device-cd #
#                    c-serial-project\main.c -D at91sam7s128 -D flash -D      #
#                    TRACE_LEVEL=3 -lC C:\Projects\in-18-nixie-clock\at91sam7 #
#                    s-ek\usb-device-cdc-serial-project\ewp\at91sam7s128_flas #
#                    h\List\ --remarks --diag_suppress Pe826,Pe1375 -o        #
#                    C:\Projects\in-18-nixie-clock\at91sam7s-ek\usb-device-cd #
#                    c-serial-project\ewp\at91sam7s128_flash\Obj\ --debug     #
#                    --endian=little --cpu=ARM7TDMI -e --fpu=None             #
#                    --dlib_config "C:\Program Files (x86)\IAR                #
#                    Systems\Embedded Workbench 5.4\arm\INC\DLib_Config_Full. #
#                    h" -I C:\Projects\in-18-nixie-clock\at91sam7s-ek\usb-dev #
#                    ice-cdc-serial-project\ewp\..\..\..\at91lib/peripherals\ #
#                     -I C:\Projects\in-18-nixie-clock\at91sam7s-ek\usb-devic #
#                    e-cdc-serial-project\ewp\..\..\..\at91lib/components\    #
#                    -I C:\Projects\in-18-nixie-clock\at91sam7s-ek\usb-device #
#                    -cdc-serial-project\ewp\..\..\..\at91lib/usb/device\ -I  #
#                    C:\Projects\in-18-nixie-clock\at91sam7s-ek\usb-device-cd #
#                    c-serial-project\ewp\..\..\..\at91lib\ -I                #
#                    C:\Projects\in-18-nixie-clock\at91sam7s-ek\usb-device-cd #
#                    c-serial-project\ewp\..\..\..\external_libs\ -I          #
#                    C:\Projects\in-18-nixie-clock\at91sam7s-ek\usb-device-cd #
#                    c-serial-project\ewp\..\..\..\at91lib/boards/at91sam7s-e #
#                    k\ -I "C:\Program Files (x86)\IAR Systems\Embedded       #
#                    Workbench 5.4\arm\INC\" --interwork --cpu_mode arm -Ohz  #
#    List file    =  C:\Projects\in-18-nixie-clock\at91sam7s-ek\usb-device-cd #
#                    c-serial-project\ewp\at91sam7s128_flash\List\main.lst    #
#    Object file  =  C:\Projects\in-18-nixie-clock\at91sam7s-ek\usb-device-cd #
#                    c-serial-project\ewp\at91sam7s128_flash\Obj\main.o       #
#                                                                             #
#                                                                             #
###############################################################################

C:\Projects\in-18-nixie-clock\at91sam7s-ek\usb-device-cdc-serial-project\main.c
      1          #include <board.h>
      2          #include <pio/pio.h>
      3          #include <pio/pio_it.h>
      4          #include <irq/irq.h>
      5          #include <tc/tc.h>
      6          #include <usart/usart.h>
      7          #include <utility/trace.h>
      8          #include <utility/led.h>
      9          #include <usb/device/cdc-serial/CDCDSerialDriver.h>
     10          #include <usb/device/cdc-serial/CDCDSerialDriverDescriptors.h>
     11          #include <pmc/pmc.h>
     12          
     13          #define PIN_USART1_RXD  {1 << 21, AT91C_BASE_PIOA, AT91C_ID_PIOA, PIO_PERIPH_A, PIO_DEFAULT}
     14          #define PIN_USART1_TXD  {1 << 22, AT91C_BASE_PIOA, AT91C_ID_PIOA, PIO_PERIPH_A, PIO_DEFAULT}
     15          
     16          
     17          #define PINS_USART1      PIN_USART1_TXD, PIN_USART1_RXD
     18          #define BASE_USART1      AT91C_BASE_US1
     19          #define ID_USART1        AT91C_ID_US1     
     20          

   \                                 In section .rodata, align 4
     21          static const Pin pinsUsart1[] = {PINS_USART1};
   \                     pinsUsart1:
   \   00000000   0000400000F4       DC32 4194304, 0FFFFF400H
   \              FFFF        
   \   00000008   02000000           DC8 2, 0, 0, 0
   \   0000000C   0000200000F4       DC32 2097152, 0FFFFF400H
   \              FFFF        
   \   00000014   02000000           DC8 2, 0, 0, 0
     22          
     23          
     24          #define PIN_DATA  {1 << 26, AT91C_BASE_PIOA, AT91C_ID_PIOA, PIO_OUTPUT_0, PIO_PULLUP}
     25          #define PIN_CLK   {1 << 24, AT91C_BASE_PIOA, AT91C_ID_PIOA, PIO_OUTPUT_0, PIO_PULLUP}
     26          #define PIN_LATCH {1 << 25, AT91C_BASE_PIOA, AT91C_ID_PIOA, PIO_OUTPUT_0, PIO_PULLUP}
     27          

   \                                 In section .rodata, align 4
   \                     `?<Constant {{1536, (AT91S_PIO *)4294964224, 2,`:
   \   00000000   0006000000F4       DC32 1536, 0FFFFF400H
   \              FFFF        
   \   00000008   02000000           DC8 2, 0, 0, 0
   \   0000000C   2D2D20555342       DC8 "-- USB Device CDC Serial Project %s --\012\015"
   \              204465766963
   \              652043444320
   \              53657269616C
   \              2050726F6A65
   \              637420257320
   \              2D2D0A0D00  
   \   00000035   000000             DC8 0, 0, 0
   \   00000038   312E372D7263       DC8 "1.7-rc1"
   \              3100        
   \   00000040   2D2D2025730A       DC8 "-- %s\012\015"
   \              0D00        
   \   00000048   415439315341       DC8 "AT91SAM7S-EK"
   \              4D37532D454B
   \              00          
   \   00000055   000000             DC8 0, 0, 0
   \   00000058   2D2D20436F6D       DC8 "-- Compiled: %s %s --\012\015"
   \              70696C65643A
   \              202573202573
   \              202D2D0A0D00
   \   00000070   4D6172203134       DC8 "Mar 14 2021"
   \              203230323100
   \   0000007C   31393A31343A       DC8 "19:14:53"
   \              353300      
   \   00000085   000000             DC8 0, 0, 0
   \   00000088   0000000400F4       DC32 67108864, 0FFFFF400H
   \              FFFF        
   \   00000090   02030100           DC8 2, 3, 1, 0
   \   00000094   0000000100F4       DC32 16777216, 0FFFFF400H
   \              FFFF        
   \   0000009C   02030100           DC8 2, 3, 1, 0
   \   000000A0   0000000200F4       DC32 33554432, 0FFFFF400H
   \              FFFF        
   \   000000A8   02030100           DC8 2, 3, 1, 0
     28          static const Pin pinData = PIN_DATA;
     29          static const Pin pinClk  = PIN_CLK;
     30          static const Pin pinLatch = PIN_LATCH;
     31          

   \                                 In section .data, align 4
     32          char hoursHI[] = {13,  5, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13};
     33          char hoursLO[] = { 1,  4,  0,  2,  8, 12, 13,  5,  3,  9,  1,  1,  1,  1,  1,  1};
     34          
     35          char minutesHI[] = { 8,  9,  1,  0, 12, 13,  8,  8,  8,  8,  8,  8,  8,  8,  8,  8};
     36          char minutesLO[] = { 2, 13, 12,  9,  4,  5,  0,  1,  8,  3,  2,  2,  2,  2,  2,  2};
     37          
     38          char secondsHI[] = { 5, 12,  8,  9,  0,  1,  5,  5,  5,  5,  5,  5,  5,  5,  5,  5};
     39          char secondsLO[] = { 2,  4,  5, 12,  0,  1,  9,  8, 13,  3,  2,  2,  2,  2,  2,  2};
     40          
     41          int globalYear = 0;
   \                     globalYear:
   \   00000000   00000000           DC32 0
     42          int globalMonth = 0;
   \                     globalMonth:
   \   00000004   00000000           DC32 0
     43          int globalDay = 0;
   \                     globalDay:
   \   00000008   00000000           DC32 0
     44          int globalHours = 0;
   \                     globalHours:
   \   0000000C   00000000           DC32 0
     45          int globalMinutes = 0;
   \                     globalMinutes:
   \   00000010   00000000           DC32 0
     46          int globalSeconds = 0;
   \                     globalSeconds:
   \   00000014   00000000           DC32 0
   \                     hoursHI:
   \   00000018   0D050C0D0D0D       DC8 13, 5, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13
   \              0D0D0D0D0D0D
   \              0D0D0D0D    
   \                     hoursLO:
   \   00000028   01040002080C       DC8 1, 4, 0, 2, 8, 12, 13, 5, 3, 9, 1, 1, 1, 1, 1, 1
   \              0D0503090101
   \              01010101    
   \                     minutesHI:
   \   00000038   080901000C0D       DC8 8, 9, 1, 0, 12, 13, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8
   \              080808080808
   \              08080808    
   \                     minutesLO:
   \   00000048   020D0C090405       DC8 2, 13, 12, 9, 4, 5, 0, 1, 8, 3, 2, 2, 2, 2, 2, 2
   \              000108030202
   \              02020202    
   \                     secondsHI:
   \   00000058   050C08090001       DC8 5, 12, 8, 9, 0, 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5
   \              050505050505
   \              05050505    
   \                     secondsLO:
   \   00000068   0204050C0001       DC8 2, 4, 5, 12, 0, 1, 9, 8, 13, 3, 2, 2, 2, 2, 2, 2
   \              09080D030202
   \              02020202    
     47          
     48          static int isDaylightSavingTime = 0;
     49          

   \                                 In section .text, align 4, keep-with-next
     50          void delay(unsigned long a) {
     51            for (int x=0;x<a;x++) asm ("nop");
   \                     delay:
   \   00000000   0010A0E3           MOV      R1,#+0
   \   00000004   010000EA           B        ??delay_0
   \                     ??delay_1:
   \   00000008   0000A0E1           nop              
   \   0000000C   011081E2           ADD      R1,R1,#+1
   \                     ??delay_0:
   \   00000010   000051E1           CMP      R1,R0
   \   00000014   FBFFFF3A           BCC      ??delay_1
     52          }
   \   00000018   1EFF2FE1           BX       LR               ;; return
     53          
     54          //------------------------------------------------------------------------------
     55          /// Handles interrupts coming from USART1
     56          //------------------------------------------------------------------------------

   \                                 In section .text, align 4, keep-with-next
     57          void USART2_IrqHandler(void)
     58          {
   \                     USART2_IrqHandler:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
     59              unsigned int status = BASE_USART1->US_CSR;
   \   00000004   ........           LDR      R0,??DataTable8  ;; 0xfffc4014
   \   00000008   005090E5           LDR      R5,[R0, #+0]
     60              unsigned short serialState;
     61          
     62              printf("USART2_IrqHandler ENTERING\n\r");
   \   0000000C   ........           LDR      R6,??DataTable8_1
   \   00000010   0600A0E1           MOV      R0,R6
   \   00000014   ........           BL       printf
     63          
     64              // Buffer has been read successfully
     65              if ((status & AT91C_US_ENDRX) != 0) {
   \   00000018   080015E3           TST      R5,#0x8
   \   0000001C   0100000A           BEQ      ??USART2_IrqHandler_0
     66                  printf("US Rx\n\r");
   \   00000020   200086E2           ADD      R0,R6,#+32
   \   00000024   ........           BL       printf
     67              }
     68          
     69              // Buffer has been sent
     70              if ((status & AT91C_US_TXBUFE) != 0) {
   \                     ??USART2_IrqHandler_0:
   \   00000028   800E15E3           TST      R5,#0x800
   \   0000002C   0100000A           BEQ      ??USART2_IrqHandler_1
     71          
     72                printf("USART2_IrqHandler Restart USB read\n\r");
   \   00000030   280086E2           ADD      R0,R6,#+40
   \   00000034   ........           BL       printf
     73                  // Restart USB read
     74                  //CDCDSerialDriver_Read(usbBuffer, DATABUFFERSIZE, (TransferCallback) UsbDataReceived, 0);
     75                  //BASE_USART1->US_IDR = AT91C_US_TXBUFE;
     76              }
     77          
     78              // Errors
     79              //serialState = CDCDSerialDriver_GetSerialState();
     80              printf("USART2_IrqHandler serialState=%i\n\r", serialState);
                                                                    ^
Warning[Pe549]: variable "serialState" is used before its value is set
   \                     ??USART2_IrqHandler_1:
   \   00000038   0410A0E1           MOV      R1,R4
   \   0000003C   500086E2           ADD      R0,R6,#+80
   \   00000040   ........           BL       printf
     81          
     82              // Overrun
     83              if ((status & AT91C_US_OVER) != 0) {
   \   00000044   800A15E3           TST      R5,#0x80000
   \   00000048   0100000A           BEQ      ??USART2_IrqHandler_2
     84          
     85                  TRACE_WARNING( "USART1_IrqHandler: Overrun\n\r");
   \   0000004C   740086E2           ADD      R0,R6,#+116
   \   00000050   ........           BL       printf
     86              }
     87          
     88              // Framing error
     89              if ((status & AT91C_US_FRAME) != 0) {
   \                     ??USART2_IrqHandler_2:
   \   00000054   400015E3           TST      R5,#0x40
   \   00000058   0100000A           BEQ      ??USART2_IrqHandler_3
     90          
     91                  TRACE_WARNING( "USART1_IrqHandler: Framing error\n\r");
   \   0000005C   980086E2           ADD      R0,R6,#+152
   \   00000060   ........           BL       printf
     92              }
     93          }
   \                     ??USART2_IrqHandler_3:
   \   00000064   6140BDE8           POP      {R0,R5,R6,LR}
   \   00000068   1EFF2FE1           BX       LR               ;; return
     94          
     95          //------------------------------------------------------------------------------
     96          //          Main
     97          //------------------------------------------------------------------------------
     98          

   \                                 In section .text, align 4, keep-with-next
     99          void InitUSART1(void)
    100          {
   \                     InitUSART1:
   \   00000000   10402DE9           PUSH     {R4,LR}
    101              PIO_Configure(pinsUsart1, PIO_LISTSIZE(pinsUsart1));
   \   00000004   0210A0E3           MOV      R1,#+2
   \   00000008   ........           LDR      R0,??DataTable8_2
   \   0000000C   ........           BL       PIO_Configure
    102              AT91C_BASE_PMC->PMC_PCER = 1 << ID_USART1;
   \   00000010   EF00E0E3           MVN      R0,#+239
   \   00000014   C00FC0E3           BIC      R0,R0,#0x300
   \   00000018   8010A0E3           MOV      R1,#+128
   \   0000001C   001080E5           STR      R1,[R0, #+0]
    103              BASE_USART1->US_IDR = 0xFFFFFFFF;
   \   00000020   ........           LDR      R4,??DataTable8_3  ;; 0xfffc4000
   \   00000024   0000E0E3           MVN      R0,#+0
   \   00000028   0C0084E5           STR      R0,[R4, #+12]
    104              USART_Configure(BASE_USART1,
    105                              USART_MODE_ASYNCHRONOUS,
    106                              9600,//115200,
    107                              BOARD_MCK);
   \   0000002C   B737A0E3           MOV      R3,#+47972352
   \   00000030   6C3C83E3           ORR      R3,R3,#0x6C00
   \   00000034   962DA0E3           MOV      R2,#+9600
   \   00000038   8C1EA0E3           MOV      R1,#+2240
   \   0000003C   0400A0E1           MOV      R0,R4
   \   00000040   ........           BL       USART_Configure
    108          
    109              USART_SetTransmitterEnabled(BASE_USART1, 1);
   \   00000044   0110A0E3           MOV      R1,#+1
   \   00000048   0400A0E1           MOV      R0,R4
   \   0000004C   ........           BL       USART_SetTransmitterEnabled
    110              USART_SetReceiverEnabled(BASE_USART1, 1);
   \   00000050   0110A0E3           MOV      R1,#+1
   \   00000054   0400A0E1           MOV      R0,R4
   \   00000058   ........           BL       USART_SetReceiverEnabled
    111              //IRQ_ConfigureIT(ID_USART1, 0, USART2_IrqHandler);
    112              //IRQ_EnableIT(ID_USART1);
    113              
    114              BASE_USART1->US_IER = AT91C_US_ENDRX | AT91C_US_FRAME | AT91C_US_OVER;
   \   0000005C   4800A0E3           MOV      R0,#+72
   \   00000060   800A80E3           ORR      R0,R0,#0x80000
   \   00000064   080084E5           STR      R0,[R4, #+8]
    115          }
   \   00000068   ........           B        ?Subroutine0

   \                                 In section .text, align 4, keep-with-next
   \                     ?Subroutine0:
   \   00000000   1040BDE8           POP      {R4,LR}
   \   00000004   1EFF2FE1           BX       LR               ;; return
    116          

   \                                 In section .text, align 4, keep-with-next
    117          unsigned char read_char_USART1_nonstop(void)
    118          {
    119            if ((BASE_USART1->US_CSR & AT91C_US_RXRDY) == 1)
   \                     read_char_USART1_nonstop:
   \   00000000   ........           LDR      R0,??DataTable8  ;; 0xfffc4014
   \   00000004   001090E5           LDR      R1,[R0, #+0]
   \   00000008   010011E3           TST      R1,#0x1
   \   0000000C   0200000A           BEQ      ??read_char_USART1_nonstop_0
    120              return ((BASE_USART1->US_RHR) & 0x1FF);
   \   00000010   040090E5           LDR      R0,[R0, #+4]
   \   00000014   FF0000E2           AND      R0,R0,#0xFF
   \   00000018   1EFF2FE1           BX       LR
    121            else
    122              return 0;
   \                     ??read_char_USART1_nonstop_0:
   \   0000001C   0000A0E3           MOV      R0,#+0
   \   00000020   1EFF2FE1           BX       LR               ;; return
    123          }
    124          
    125          #define BUFFERSIZE 1024
    126          
    127          static int UTC_OFFSET=3;
    128          

   \                                 In section .bss, align 4
    129          static char gpsBuffer[BUFFERSIZE];
    130          static int currentBufferIndex = 0;
   \                     currentBufferIndex:
   \   00000000                      DS8 4
   \   00000004                      DS8 4
   \   00000008                      DS8 1024
    131          static int isGPSCommand = 0;
    132          
    133          void extractTime(char * rmc_data);
    134          void showTime();
    135          

   \                                 In section .text, align 4, keep-with-next
    136          void writeByte(unsigned char data) {
   \                     writeByte:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
   \   00000004   0040A0E1           MOV      R4,R0
    137            int delayValue = 10;
    138            for (int i = 0; i < 8; i++) {
   \   00000008   0050A0E3           MOV      R5,#+0
   \   0000000C   ........           LDR      R6,??DataTable8_4
    139              int b = (data >> i) & 0x1;
    140          
    141              //delay(5000);
    142              delay(delayValue);
   \                     ??writeByte_0:
   \   00000010   0A00A0E3           MOV      R0,#+10
   \   00000014   ........           BL       delay
    143              PIO_Clear(&pinClk);
   \   00000018   940086E2           ADD      R0,R6,#+148
   \   0000001C   ........           BL       PIO_Clear
    144              delay(delayValue);
   \   00000020   0A00A0E3           MOV      R0,#+10
   \   00000024   ........           BL       delay
    145              if (b>0) {
   \   00000028   0110A0E3           MOV      R1,#+1
   \   0000002C   540501E0           AND      R0,R1,R4, ASR R5
   \   00000030   010050E3           CMP      R0,#+1
   \   00000034   0A00A0E3           MOV      R0,#+10
   \   00000038   030000BA           BLT      ??writeByte_1
    146                delay(delayValue);
   \   0000003C   ........           BL       delay
    147                PIO_Set(&pinData);
   \   00000040   880086E2           ADD      R0,R6,#+136
   \   00000044   ........           BL       PIO_Set
    148                delay(delayValue);
   \   00000048   020000EA           B        ??writeByte_2
    149              } else {
    150                delay(delayValue);
   \                     ??writeByte_1:
   \   0000004C   ........           BL       delay
    151                PIO_Clear(&pinData);
   \   00000050   880086E2           ADD      R0,R6,#+136
   \   00000054   ........           BL       PIO_Clear
    152                delay(delayValue);
   \                     ??writeByte_2:
   \   00000058   0A00A0E3           MOV      R0,#+10
   \   0000005C   ........           BL       delay
    153              }
    154              delay(delayValue);
   \   00000060   0A00A0E3           MOV      R0,#+10
   \   00000064   ........           BL       delay
    155              PIO_Set(&pinClk);
   \   00000068   940086E2           ADD      R0,R6,#+148
   \   0000006C   ........           BL       PIO_Set
    156              delay(delayValue);
   \   00000070   0A00A0E3           MOV      R0,#+10
   \   00000074   ........           BL       delay
    157            }
   \   00000078   015085E2           ADD      R5,R5,#+1
   \   0000007C   080055E3           CMP      R5,#+8
   \   00000080   E2FFFFBA           BLT      ??writeByte_0
    158          }
   \   00000084   7040BDE8           POP      {R4-R6,LR}
   \   00000088   1EFF2FE1           BX       LR               ;; return
    159          
    160          //Summer time functions----

   \                                 In section .text, align 4, keep-with-next
    161          int DayOfWeek(int day, int month, int year) {
   \                     DayOfWeek:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   0080A0E1           MOV      R8,R0
   \   00000008   0140A0E1           MOV      R4,R1
   \   0000000C   0270A0E1           MOV      R7,R2
    162            int a = (14 - month) / 12;
   \   00000010   0C50A0E3           MOV      R5,#+12
   \   00000014   0E0064E2           RSB      R0,R4,#+14
   \   00000018   0C10A0E3           MOV      R1,#+12
   \   0000001C   ........           BL       __aeabi_idiv
   \   00000020   0060A0E1           MOV      R6,R0
    163            int y = year - a;
   \   00000024   067047E0           SUB      R7,R7,R6
    164            int m = month + 12 * a - 2;
    165            return (7000 + (day + y + y / 4 - y / 100 + y / 400 + (31 * m) / 12)) % 7;
   \   00000028   080087E0           ADD      R0,R7,R8
   \   0000002C   C710A0E1           ASR      R1,R7,#+1
   \   00000030   211F87E0           ADD      R1,R7,R1, LSR #+30
   \   00000034   418180E0           ADD      R8,R0,R1, ASR #+2
   \   00000038   0700A0E1           MOV      R0,R7
   \   0000003C   6410A0E3           MOV      R1,#+100
   \   00000040   ........           BL       __aeabi_idiv
   \   00000044   008048E0           SUB      R8,R8,R0
   \   00000048   0700A0E1           MOV      R0,R7
   \   0000004C   641FA0E3           MOV      R1,#+400
   \   00000050   ........           BL       __aeabi_idiv
   \   00000054   087080E0           ADD      R7,R0,R8
   \   00000058   954620E0           MLA      R0,R5,R6,R4
   \   0000005C   020040E2           SUB      R0,R0,#+2
   \   00000060   800260E0           RSB      R0,R0,R0, LSL #+5
   \   00000064   0C10A0E3           MOV      R1,#+12
   \   00000068   ........           BL       __aeabi_idiv
   \   0000006C   070080E0           ADD      R0,R0,R7
   \   00000070   5810A0E3           MOV      R1,#+88
   \   00000074   6C1D81E3           ORR      R1,R1,#0x1B00
   \   00000078   000081E0           ADD      R0,R1,R0
   \   0000007C   0710A0E3           MOV      R1,#+7
   \   00000080   ........           BL       __aeabi_idivmod
   \   00000084   0100A0E1           MOV      R0,R1
   \   00000088   ........           B        ?Subroutine1
    166          }

   \                                 In section .text, align 4, keep-with-next
   \                     ?Subroutine1:
   \   00000000   F041BDE8           POP      {R4-R8,LR}
   \   00000004   1EFF2FE1           BX       LR               ;; return
    167          

   \                                 In section .text, align 4, keep-with-next
    168          int IsLeapYear (int year) {
   \                     IsLeapYear:
   \   00000000   10402DE9           PUSH     {R4,LR}
   \   00000004   0040A0E1           MOV      R4,R0
    169            //return ((year % 400) == 0) || (((year % 4) == 0) && ((year % 100) ~= 0));
    170            if ((year & 3) == 0 && ((year % 25) != 0 || (year & 15) == 0)) {
   \   00000008   030014E3           TST      R4,#0x3
   \   0000000C   0700001A           BNE      ??IsLeapYear_0
   \   00000010   1910A0E3           MOV      R1,#+25
   \   00000014   ........           BL       __aeabi_idivmod
   \   00000018   000051E3           CMP      R1,#+0
   \   0000001C   0100001A           BNE      ??IsLeapYear_1
   \   00000020   0F0014E3           TST      R4,#0xF
   \   00000024   0100001A           BNE      ??IsLeapYear_0
    171              return 1;
   \                     ??IsLeapYear_1:
   \   00000028   0100A0E3           MOV      R0,#+1
   \   0000002C   000000EA           B        ??IsLeapYear_2
    172            } else {
    173              return 0;
   \                     ??IsLeapYear_0:
   \   00000030   0000A0E3           MOV      R0,#+0
    174            }
   \                     ??IsLeapYear_2:
   \   00000034                      REQUIRE ?Subroutine0
   \   00000034                      ;; // Fall through to label ?Subroutine0
    175          }
    176          

   \                                 In section .text, align 4, keep-with-next
    177          int MonthDay(int Month, int Year)
    178          {
   \                     MonthDay:
   \   00000000   10402DE9           PUSH     {R4,LR}
   \   00000004   0140A0E1           MOV      R4,R1
    179            if(Month == 1) {
   \   00000008   010050E3           CMP      R0,#+1
   \   0000000C   0100001A           BNE      ??MonthDay_0
    180              return 31;
   \                     ??MonthDay_1:
   \   00000010   1F00A0E3           MOV      R0,#+31
   \   00000014   230000EA           B        ??MonthDay_2
    181            } else if (Month == 2 && IsLeapYear(Year) == 1) {
   \                     ??MonthDay_0:
   \   00000018   020050E3           CMP      R0,#+2
   \   0000001C   0500001A           BNE      ??MonthDay_3
   \   00000020   0400A0E1           MOV      R0,R4
   \   00000024   ........           BL       IsLeapYear
   \   00000028   010050E3           CMP      R0,#+1
   \   0000002C   0700001A           BNE      ??MonthDay_4
    182              return 29;
   \   00000030   1D00A0E3           MOV      R0,#+29
   \   00000034   1B0000EA           B        ??MonthDay_2
    183            } else if (Month == 2 && IsLeapYear(Year) == 0) {
    184              return 28;
    185            } else if (Month == 3) {
   \                     ??MonthDay_3:
   \   00000038   030050E3           CMP      R0,#+3
   \   0000003C   F3FFFF0A           BEQ      ??MonthDay_1
    186              return 31;
    187            } else if (Month == 4) {
   \   00000040   040050E3           CMP      R0,#+4
   \   00000044   0700001A           BNE      ??MonthDay_5
    188              return 30;
   \                     ??MonthDay_6:
   \   00000048   1E00A0E3           MOV      R0,#+30
   \   0000004C   150000EA           B        ??MonthDay_2
    189            } else if (Month == 5) {
   \                     ??MonthDay_4:
   \   00000050   0400A0E1           MOV      R0,R4
   \   00000054   ........           BL       IsLeapYear
   \   00000058   000050E3           CMP      R0,#+0
   \   0000005C   1000001A           BNE      ??MonthDay_7
   \   00000060   1C00A0E3           MOV      R0,#+28
   \   00000064   0F0000EA           B        ??MonthDay_2
   \                     ??MonthDay_5:
   \   00000068   050050E3           CMP      R0,#+5
   \   0000006C   E7FFFF0A           BEQ      ??MonthDay_1
    190              return 31;
    191            } else if (Month == 6) {
   \   00000070   060050E3           CMP      R0,#+6
   \   00000074   F3FFFF0A           BEQ      ??MonthDay_6
    192              return 30;
    193            } else if (Month == 7) {
   \   00000078   070050E3           CMP      R0,#+7
    194              return 31;
    195            } else if (Month == 8) {
   \   0000007C   08005013           CMPNE    R0,#+8
   \   00000080   E2FFFF0A           BEQ      ??MonthDay_1
    196              return 31;
    197            } else if (Month == 9) {
   \   00000084   090050E3           CMP      R0,#+9
   \   00000088   EEFFFF0A           BEQ      ??MonthDay_6
    198              return 30;
    199            } else if (Month == 10) {
   \   0000008C   0A0050E3           CMP      R0,#+10
   \   00000090   DEFFFF0A           BEQ      ??MonthDay_1
    200              return 31;
    201            } else if (Month == 11) {
   \   00000094   0B0050E3           CMP      R0,#+11
   \   00000098   EAFFFF0A           BEQ      ??MonthDay_6
    202              return 30;
    203            } else if (Month == 12) {
   \   0000009C   0C0050E3           CMP      R0,#+12
   \   000000A0   DAFFFF0A           BEQ      ??MonthDay_1
    204              return 31;
    205            } else return 0;
   \                     ??MonthDay_7:
   \   000000A4   0000A0E3           MOV      R0,#+0
   \                     ??MonthDay_2:
   \   000000A8   ........           B        ?Subroutine0
    206          }
    207          

   \                                 In section .text, align 4, keep-with-next
    208          void correctSummertime(/*int Year, int Month, int Day, int Hour, int Minute, int Second*/)
    209          {
   \                     correctSummertime:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
    210            //int zone = UTC_OFFSET;
    211              
    212            //Ќаходим последнее воскресенье марта и последнее воскресенье окт€бр€
    213            int M = 31 - DayOfWeek(31,3,globalYear);
   \   00000004   ........           LDR      R4,??DataTable8_5
   \   00000008   005094E5           LDR      R5,[R4, #+0]
   \   0000000C   0520A0E1           MOV      R2,R5
   \   00000010   0310A0E3           MOV      R1,#+3
   \   00000014   1F00A0E3           MOV      R0,#+31
   \   00000018   ........           BL       DayOfWeek
   \   0000001C   1F8060E2           RSB      R8,R0,#+31
    214            int O = 31 - DayOfWeek(31,10,globalYear);
   \   00000020   0520A0E1           MOV      R2,R5
   \   00000024   0A10A0E3           MOV      R1,#+10
   \   00000028   1F00A0E3           MOV      R0,#+31
   \   0000002C   ........           BL       DayOfWeek
   \   00000030   1F0060E2           RSB      R0,R0,#+31
    215            
    216            //”чЄт летнего времни (с последнего воскресень€ марта до последнего воскресень€ окт€бр€)
    217            //incorrect old implementation
    218            /*
    219            if (((globalMonth > 3) && (globalMonth < 10)) || 
    220                ((globalMonth == 3) && (globalDay >= M) && globalHours >= 0) || 
    221                  ((globalMonth == 10) && (globalDay <= O) && globalHours <= 1 ))
    222          {
    223                    zone = zone + 1;
    224                  }
    225            if ((globalHours + zone) < 24)
    226          {
    227              globalHours = globalHours + zone;
    228            } else
    229          {
    230              globalHours = globalHours + zone - 24;
    231              if ((globalDay + 1) <= MonthDay(globalMonth, globalYear))
    232          {
    233                globalDay = globalDay + 1;
    234              } else
    235          {
    236                globalDay = 1;
    237                if ((globalMonth + 1) <= 12)
    238          {
    239                  globalMonth = globalMonth + 1;
    240                }
    241          else
    242          {
    243                  globalMonth = 1;
    244                  globalYear = globalYear + 1;
    245                }
    246              }
    247            }*/
    248            int summertimeOffset = 0;
   \   00000034   0010A0E3           MOV      R1,#+0
    249            
    250            if (((globalMonth > 3) && (globalMonth < 10)) || 
    251                ((globalMonth == 3) && (globalDay >= M)) || 
    252                ((globalMonth == 10) && (globalDay <= O))) {
   \   00000038   0C2094E5           LDR      R2,[R4, #+12]
   \   0000003C   086094E5           LDR      R6,[R4, #+8]
   \   00000040   047094E5           LDR      R7,[R4, #+4]
   \   00000044   043047E2           SUB      R3,R7,#+4
   \   00000048   060053E3           CMP      R3,#+6
   \   0000004C   0900003A           BCC      ??correctSummertime_0
   \   00000050   030057E3           CMP      R7,#+3
   \   00000054   0200001A           BNE      ??correctSummertime_1
   \   00000058   080056E1           CMP      R6,R8
   \   0000005C   070000AA           BGE      ??correctSummertime_2
   \   00000060   110000EA           B        ??correctSummertime_3
   \                     ??correctSummertime_1:
   \   00000064   0A0057E3           CMP      R7,#+10
   \   00000068   0F00001A           BNE      ??correctSummertime_3
   \   0000006C   060050E1           CMP      R0,R6
   \   00000070   0D0000BA           BLT      ??correctSummertime_3
   \   00000074   080000EA           B        ??correctSummertime_4
    253          
    254                isDaylightSavingTime = 1;
    255          
    256                if ((globalMonth == 3) && (globalDay == M) && globalHours < 3 ) {
   \                     ??correctSummertime_0:
   \   00000078   030057E3           CMP      R7,#+3
   \   0000007C   0400001A           BNE      ??correctSummertime_5
   \                     ??correctSummertime_2:
   \   00000080   080056E1           CMP      R6,R8
   \   00000084   0700001A           BNE      ??correctSummertime_6
   \   00000088   030052E3           CMP      R2,#+3
   \   0000008C   050000AA           BGE      ??correctSummertime_6
   \   00000090   050000EA           B        ??correctSummertime_3
    257                  isDaylightSavingTime = 0;
    258                }
    259          
    260                if ((globalMonth == 10) && (globalDay >= O) && globalHours >=3 ) {
   \                     ??correctSummertime_5:
   \   00000094   0A0057E3           CMP      R7,#+10
   \   00000098   0200001A           BNE      ??correctSummertime_6
   \                     ??correctSummertime_4:
   \   0000009C   000056E1           CMP      R6,R0
   \   000000A0   030052A3           CMPGE    R2,#+3
   \   000000A4   000000AA           BGE      ??correctSummertime_3
    261                  isDaylightSavingTime = 0;
    262                }
    263                
    264                if (isDaylightSavingTime > 0) {
    265                  summertimeOffset = 1;
   \                     ??correctSummertime_6:
   \   000000A8   0110A0E3           MOV      R1,#+1
    266                }
    267            }
    268          
    269            if ((globalHours + summertimeOffset) < 24) {
   \                     ??correctSummertime_3:
   \   000000AC   020081E0           ADD      R0,R1,R2
   \   000000B0   180050E3           CMP      R0,#+24
    270              globalHours = globalHours + summertimeOffset;
   \   000000B4   0C0084B5           STRLT    R0,[R4, #+12]
   \   000000B8   0E0000BA           BLT      ??correctSummertime_7
    271            } else {
    272              globalHours = globalHours + summertimeOffset - 24;
   \   000000BC   180041E2           SUB      R0,R1,#+24
   \   000000C0   020080E0           ADD      R0,R0,R2
   \   000000C4   0C0084E5           STR      R0,[R4, #+12]
    273              if ((globalDay + 1) <= MonthDay(globalMonth, globalYear)) {
   \   000000C8   016086E2           ADD      R6,R6,#+1
   \   000000CC   0510A0E1           MOV      R1,R5
   \   000000D0   0700A0E1           MOV      R0,R7
   \   000000D4   ........           BL       MonthDay
   \   000000D8   060050E1           CMP      R0,R6
   \   000000DC   050000AA           BGE      ??correctSummertime_7
    274                globalDay = globalDay + 1;
    275              } else {
    276                globalDay = 1;
   \   000000E0   0160A0E3           MOV      R6,#+1
    277                if ((globalMonth + 1) <= 12) {
   \   000000E4   017087E2           ADD      R7,R7,#+1
   \   000000E8   0D0057E3           CMP      R7,#+13
    278                  globalMonth = globalMonth + 1;
    279                } else {
    280                  globalMonth = 1;
   \   000000EC   0170A0A3           MOVGE    R7,#+1
    281                  globalYear = globalYear + 1;
   \   000000F0   010085A2           ADDGE    R0,R5,#+1
   \   000000F4   000084A5           STRGE    R0,[R4, #+0]
   \                     ??correctSummertime_7:
   \   000000F8   086084E5           STR      R6,[R4, #+8]
   \   000000FC   047084E5           STR      R7,[R4, #+4]
    282                }
    283              }
    284            }
    285          }
   \   00000100                      REQUIRE ?Subroutine1
   \   00000100                      ;; // Fall through to label ?Subroutine1
    286          

   \                                 In section .text, align 4, keep-with-next
    287          void correctTimezone() {
   \                     correctTimezone:
   \   00000000   F8402DE9           PUSH     {R3-R7,LR}
    288            int zone = UTC_OFFSET;
    289            
    290            if ((globalHours + zone) < 24) {
   \   00000004   ........           LDR      R4,??DataTable8_5
   \   00000008   085094E5           LDR      R5,[R4, #+8]
   \   0000000C   046094E5           LDR      R6,[R4, #+4]
   \   00000010   0C0094E5           LDR      R0,[R4, #+12]
   \   00000014   031080E2           ADD      R1,R0,#+3
   \   00000018   180051E3           CMP      R1,#+24
    291              globalHours = globalHours + zone;
   \   0000001C   0C1084B5           STRLT    R1,[R4, #+12]
   \   00000020   0E0000BA           BLT      ??correctTimezone_0
    292            } else {
    293              globalHours = globalHours + zone - 24;
   \   00000024   150040E2           SUB      R0,R0,#+21
   \   00000028   0C0084E5           STR      R0,[R4, #+12]
    294              if ((globalDay + 1) <= MonthDay(globalMonth, globalYear)) {
   \   0000002C   015085E2           ADD      R5,R5,#+1
   \   00000030   007094E5           LDR      R7,[R4, #+0]
   \   00000034   0710A0E1           MOV      R1,R7
   \   00000038   0600A0E1           MOV      R0,R6
   \   0000003C   ........           BL       MonthDay
   \   00000040   050050E1           CMP      R0,R5
   \   00000044   050000AA           BGE      ??correctTimezone_0
    295                globalDay = globalDay + 1;
    296              } else {
    297                globalDay = 1;
   \   00000048   0150A0E3           MOV      R5,#+1
    298                if ((globalMonth + 1) <= 12) {
   \   0000004C   016086E2           ADD      R6,R6,#+1
   \   00000050   0D0056E3           CMP      R6,#+13
    299                  globalMonth = globalMonth + 1;
    300                } else {
    301                  globalMonth = 1;
   \   00000054   0160A0A3           MOVGE    R6,#+1
    302                  globalYear = globalYear + 1;
   \   00000058   010087A2           ADDGE    R0,R7,#+1
   \   0000005C   000084A5           STRGE    R0,[R4, #+0]
   \                     ??correctTimezone_0:
   \   00000060   046084E5           STR      R6,[R4, #+4]
   \   00000064   085084E5           STR      R5,[R4, #+8]
    303                }
    304              }
    305            }
    306          }
   \   00000068   F140BDE8           POP      {R0,R4-R7,LR}
   \   0000006C   1EFF2FE1           BX       LR               ;; return
    307          //-------------------------
    308          

   \                                 In section .text, align 4, keep-with-next
    309          void processChar(char c) {
   \                     processChar:
   \   00000000   38402DE9           PUSH     {R3-R5,LR}
   \   00000004   0050A0E1           MOV      R5,R0
    310            if (isGPSCommand == 0) {
   \   00000008   0000A0E3           MOV      R0,#+0
   \   0000000C   ........           LDR      R4,??DataTable8_6
   \   00000010   041094E5           LDR      R1,[R4, #+4]
   \   00000014   000051E3           CMP      R1,#+0
   \   00000018   0900001A           BNE      ??processChar_0
    311              if (c == '$') {
   \   0000001C   240055E3           CMP      R5,#+36
   \   00000020   1500001A           BNE      ??processChar_1
    312                isGPSCommand = 1;
   \   00000024   0110A0E3           MOV      R1,#+1
   \   00000028   041084E5           STR      R1,[R4, #+4]
    313                currentBufferIndex = 0;
   \   0000002C   000084E5           STR      R0,[R4, #+0]
    314                memset(gpsBuffer, 0, BUFFERSIZE);
                       ^
Warning[Pe223]: function "memset" declared implicitly
   \   00000030   402EA0E3           MOV      R2,#+1024
   \   00000034   0010A0E3           MOV      R1,#+0
   \   00000038   080084E2           ADD      R0,R4,#+8
   \   0000003C   ........           BL       memset
   \   00000040   060000EA           B        ??processChar_2
    315                //printf("command start\n\r");
    316              }
    317            } else if (c == 10 || c == 13 || c == '$') {
   \                     ??processChar_0:
   \   00000044   0A0055E3           CMP      R5,#+10
   \   00000048   0D005513           CMPNE    R5,#+13
   \   0000004C   24005513           CMPNE    R5,#+36
   \   00000050   0200001A           BNE      ??processChar_2
    318                isGPSCommand = 0;
   \   00000054   040084E5           STR      R0,[R4, #+4]
    319                //printf("time to extract\n\r");
    320                extractTime(gpsBuffer);
   \   00000058   080084E2           ADD      R0,R4,#+8
   \   0000005C   ........           BL       extractTime
    321            }
    322            
    323            if (isGPSCommand == 1) {
   \                     ??processChar_2:
   \   00000060   040094E5           LDR      R0,[R4, #+4]
   \   00000064   010050E3           CMP      R0,#+1
    324              gpsBuffer[currentBufferIndex++] = c;
   \   00000068   00009405           LDREQ    R0,[R4, #+0]
   \   0000006C   04108000           ADDEQ    R1,R0,R4
   \   00000070   0850C105           STRBEQ   R5,[R1, #+8]
   \   00000074   01008002           ADDEQ    R0,R0,#+1
   \   00000078   00008405           STREQ    R0,[R4, #+0]
    325            }
    326          }
   \                     ??processChar_1:
   \   0000007C   3140BDE8           POP      {R0,R4,R5,LR}
   \   00000080   1EFF2FE1           BX       LR               ;; return
    327          

   \                                 In section .text, align 4, keep-with-next
    328          void extractTime(char * rmc_data) {
   \                     extractTime:
   \   00000000   F04F2DE9           PUSH     {R4-R11,LR}
   \   00000004   14D04DE2           SUB      SP,SP,#+20
   \   00000008   0040A0E1           MOV      R4,R0
    329            if(strncmp(rmc_data, "$GPZDA", 6) == 0){
                      ^
Warning[Pe223]: function "strncmp" declared implicitly
   \   0000000C   ........           LDR      R5,??DataTable8_7
   \   00000010   0620A0E3           MOV      R2,#+6
   \   00000014   401085E2           ADD      R1,R5,#+64
   \   00000018   ........           BL       strncmp
   \   0000001C   000050E3           CMP      R0,#+0
   \   00000020   7800001A           BNE      ??extractTime_0
    330              int i = 0;
   \   00000024   0120A0E3           MOV      R2,#+1
   \   00000028   C02F82E3           ORR      R2,R2,#0x300
   \   0000002C   010000EA           B        ??extractTime_1
    331              int got_hour;
    332              int got_min;
    333              int got_sec;
    334              int got_day;
    335              int got_month;
    336              int got_year;
    337          
    338              while(rmc_data[i++] != ','){ if (i > 768) return; };
   \                     ??extractTime_2:
   \   00000030   020050E1           CMP      R0,R2
   \   00000034   730000AA           BGE      ??extractTime_0
   \                     ??extractTime_1:
   \   00000038   0010A0E1           MOV      R1,R0
   \   0000003C   010081E2           ADD      R0,R1,#+1
   \   00000040   0410D1E7           LDRB     R1,[R1, +R4]
   \   00000044   2C0051E3           CMP      R1,#+44
   \   00000048   F8FFFF1A           BNE      ??extractTime_2
    339                  got_hour = (rmc_data[i]-'0')*10 + (rmc_data[i+1]-'0');
   \   0000004C   0A10A0E3           MOV      R1,#+10
   \   00000050   0430D0E7           LDRB     R3,[R0, +R4]
   \   00000054   04C080E0           ADD      R12,R0,R4
   \   00000058   01C0DCE5           LDRB     R12,[R12, #+1]
   \   0000005C   91C323E0           MLA      R3,R1,R3,R12
   \   00000060   0FC0E0E3           MVN      R12,#+15
   \   00000064   80CFCCE3           BIC      R12,R12,#0x200
   \   00000068   03608CE0           ADD      R6,R12,R3
    340          	got_min = ((rmc_data[i+2]-'0')*10)+(rmc_data[i+3]-'0');
   \   0000006C   043080E0           ADD      R3,R0,R4
   \   00000070   0230D3E5           LDRB     R3,[R3, #+2]
   \   00000074   04C080E0           ADD      R12,R0,R4
   \   00000078   03C0DCE5           LDRB     R12,[R12, #+3]
   \   0000007C   91C323E0           MLA      R3,R1,R3,R12
   \   00000080   0FC0E0E3           MVN      R12,#+15
   \   00000084   80CFCCE3           BIC      R12,R12,#0x200
   \   00000088   03708CE0           ADD      R7,R12,R3
   \   0000008C   10708DE5           STR      R7,[SP, #+16]
    341          	got_sec = ((rmc_data[i+4]-'0')*10)+(rmc_data[i+5]-'0');
   \   00000090   043080E0           ADD      R3,R0,R4
   \   00000094   0430D3E5           LDRB     R3,[R3, #+4]
   \   00000098   04C080E0           ADD      R12,R0,R4
   \   0000009C   05C0DCE5           LDRB     R12,[R12, #+5]
   \   000000A0   91C323E0           MLA      R3,R1,R3,R12
   \   000000A4   0FC0E0E3           MVN      R12,#+15
   \   000000A8   80CFCCE3           BIC      R12,R12,#0x200
   \   000000AC   03808CE0           ADD      R8,R12,R3
   \   000000B0   0C808DE5           STR      R8,[SP, #+12]
    342          	i+=6;
   \   000000B4   060080E2           ADD      R0,R0,#+6
   \   000000B8   010000EA           B        ??extractTime_3
    343          	while(rmc_data[i++] != ','){ if (i > 768) return; };
   \                     ??extractTime_4:
   \   000000BC   020050E1           CMP      R0,R2
   \   000000C0   500000AA           BGE      ??extractTime_0
   \                     ??extractTime_3:
   \   000000C4   0030A0E1           MOV      R3,R0
   \   000000C8   010083E2           ADD      R0,R3,#+1
   \   000000CC   0430D3E7           LDRB     R3,[R3, +R4]
   \   000000D0   2C0053E3           CMP      R3,#+44
   \   000000D4   F8FFFF1A           BNE      ??extractTime_4
    344          	got_day = ((rmc_data[i]-'0')*10)+(rmc_data[i+1]-'0');
   \   000000D8   0430D0E7           LDRB     R3,[R0, +R4]
   \   000000DC   04C080E0           ADD      R12,R0,R4
   \   000000E0   01C0DCE5           LDRB     R12,[R12, #+1]
   \   000000E4   91C323E0           MLA      R3,R1,R3,R12
   \   000000E8   0FC0E0E3           MVN      R12,#+15
   \   000000EC   80CFCCE3           BIC      R12,R12,#0x200
   \   000000F0   03908CE0           ADD      R9,R12,R3
   \   000000F4   010000EA           B        ??extractTime_5
    345          	while(rmc_data[i++] != ','){ if (i > 768) return; };
   \                     ??extractTime_6:
   \   000000F8   020050E1           CMP      R0,R2
   \   000000FC   410000AA           BGE      ??extractTime_0
   \                     ??extractTime_5:
   \   00000100   0030A0E1           MOV      R3,R0
   \   00000104   010083E2           ADD      R0,R3,#+1
   \   00000108   0430D3E7           LDRB     R3,[R3, +R4]
   \   0000010C   2C0053E3           CMP      R3,#+44
   \   00000110   F8FFFF1A           BNE      ??extractTime_6
    346          	got_month = ((rmc_data[i]-'0')*10)+(rmc_data[i+1]-'0');
   \   00000114   0430D0E7           LDRB     R3,[R0, +R4]
   \   00000118   04C080E0           ADD      R12,R0,R4
   \   0000011C   01C0DCE5           LDRB     R12,[R12, #+1]
   \   00000120   91C323E0           MLA      R3,R1,R3,R12
   \   00000124   0FC0E0E3           MVN      R12,#+15
   \   00000128   80CFCCE3           BIC      R12,R12,#0x200
   \   0000012C   03A08CE0           ADD      R10,R12,R3
   \   00000130   010000EA           B        ??extractTime_7
    347          	while(rmc_data[i++] != ','){ if (i > 768) return; };
   \                     ??extractTime_8:
   \   00000134   020050E1           CMP      R0,R2
   \   00000138   320000AA           BGE      ??extractTime_0
   \                     ??extractTime_7:
   \   0000013C   0030A0E1           MOV      R3,R0
   \   00000140   010083E2           ADD      R0,R3,#+1
   \   00000144   0430D3E7           LDRB     R3,[R3, +R4]
   \   00000148   2C0053E3           CMP      R3,#+44
   \   0000014C   F8FFFF1A           BNE      ??extractTime_8
    348          	got_year = ((rmc_data[i]-'0')*1000)+(rmc_data[i+1]-'0')*100 + (rmc_data[i+2]-'0')*10+(rmc_data[i+3]-'0');
   \   00000150   0420D0E7           LDRB     R2,[R0, +R4]
   \   00000154   FA3FA0E3           MOV      R3,#+1000
   \   00000158   04C080E0           ADD      R12,R0,R4
   \   0000015C   01C0DCE5           LDRB     R12,[R12, #+1]
   \   00000160   64E0A0E3           MOV      LR,#+100
   \   00000164   9E0C0CE0           MUL      R12,LR,R12
   \   00000168   93C222E0           MLA      R2,R3,R2,R12
   \   0000016C   043080E0           ADD      R3,R0,R4
   \   00000170   0230D3E5           LDRB     R3,[R3, #+2]
   \   00000174   912322E0           MLA      R2,R1,R3,R2
   \   00000178   040080E0           ADD      R0,R0,R4
   \   0000017C   0300D0E5           LDRB     R0,[R0, #+3]
   \   00000180   020080E0           ADD      R0,R0,R2
   \   00000184   4F10E0E3           MVN      R1,#+79
   \   00000188   D01CC1E3           BIC      R1,R1,#0xD000
   \   0000018C   004081E0           ADD      R4,R1,R0
    349                  
    350                  printf("time: %i:%i:%i %i.%i.%i\n\r", got_hour, got_min, got_sec, got_day, got_month, got_year);
   \   00000190   08408DE5           STR      R4,[SP, #+8]
   \   00000194   04A08DE5           STR      R10,[SP, #+4]
   \   00000198   00908DE5           STR      R9,[SP, #+0]
   \   0000019C   0C309DE5           LDR      R3,[SP, #+12]
   \   000001A0   10209DE5           LDR      R2,[SP, #+16]
   \   000001A4   0610A0E1           MOV      R1,R6
   \   000001A8   0500A0E1           MOV      R0,R5
   \   000001AC   ........           BL       printf
    351          
    352                  globalYear = got_year;
   \   000001B0   ........           LDR      R11,??DataTable8_5
   \   000001B4   00408BE5           STR      R4,[R11, #+0]
    353                  globalMonth = got_month;
   \   000001B8   04A08BE5           STR      R10,[R11, #+4]
    354                  globalDay = got_day;
   \   000001BC   08908BE5           STR      R9,[R11, #+8]
    355                  globalHours = got_hour;
   \   000001C0   0C608BE5           STR      R6,[R11, #+12]
    356                  globalMinutes = got_min;
   \   000001C4   10009DE5           LDR      R0,[SP, #+16]
   \   000001C8   10008BE5           STR      R0,[R11, #+16]
    357                  globalSeconds = got_sec;
   \   000001CC   0C009DE5           LDR      R0,[SP, #+12]
   \   000001D0   14008BE5           STR      R0,[R11, #+20]
    358          
    359          	/*got_hour += UTC_OFFSET;
    360          	if(got_hour >= 24){
    361          		got_hour = got_hour - 24;
    362          		got_day++;
    363          	}*/
    364                  correctTimezone();
   \   000001D4   ........           BL       correctTimezone
    365                  //Correct hours due to summertime
    366                  //correctSummertime();
    367                  //-------------------------------
    368                  printf("corrected time: %i:%i:%i %i.%i.%i\n\r", globalHours, globalMinutes, globalSeconds, globalDay, globalMonth, globalYear);
   \   000001D8   00009BE5           LDR      R0,[R11, #+0]
   \   000001DC   08008DE5           STR      R0,[SP, #+8]
   \   000001E0   04009BE5           LDR      R0,[R11, #+4]
   \   000001E4   04008DE5           STR      R0,[SP, #+4]
   \   000001E8   08009BE5           LDR      R0,[R11, #+8]
   \   000001EC   00008DE5           STR      R0,[SP, #+0]
   \   000001F0   0830A0E1           MOV      R3,R8
   \   000001F4   0720A0E1           MOV      R2,R7
   \   000001F8   0C109BE5           LDR      R1,[R11, #+12]
   \   000001FC   1C0085E2           ADD      R0,R5,#+28
   \   00000200   ........           BL       printf
    369                  //SHOW TIME
    370                  showTime();
   \   00000204   ........           BL       showTime
   \                     ??extractTime_0:
   \   00000208   14D08DE2           ADD      SP,SP,#+20       ;; stack cleaning
   \   0000020C   F04FBDE8           POP      {R4-R11,LR}
   \   00000210   1EFF2FE1           BX       LR               ;; return
    371                  //END SHOW TIME
    372              }
    373          }
    374          

   \                                 In section .text, align 4, keep-with-next
    375          void showTime() {
   \                     showTime:
   \   00000000   F84F2DE9           PUSH     {R3-R11,LR}
    376            
    377            int hourHi = globalHours / 10;
   \   00000004   ........           LDR      R4,??DataTable8_5
   \   00000008   0C6094E5           LDR      R6,[R4, #+12]
   \   0000000C   0600A0E1           MOV      R0,R6
   \   00000010   0A10A0E3           MOV      R1,#+10
   \   00000014   ........           BL       __aeabi_idiv
   \   00000018   0050A0E1           MOV      R5,R0
    378            int hourLo = globalHours % 10;
   \   0000001C   0600A0E1           MOV      R0,R6
   \   00000020   0A10A0E3           MOV      R1,#+10
   \   00000024   ........           BL       __aeabi_idivmod
   \   00000028   0160A0E1           MOV      R6,R1
    379            int minHi = globalMinutes / 10;
   \   0000002C   108094E5           LDR      R8,[R4, #+16]
   \   00000030   0800A0E1           MOV      R0,R8
   \   00000034   0A10A0E3           MOV      R1,#+10
   \   00000038   ........           BL       __aeabi_idiv
   \   0000003C   0070A0E1           MOV      R7,R0
    380            int minLo = globalMinutes % 10;
   \   00000040   0800A0E1           MOV      R0,R8
   \   00000044   0A10A0E3           MOV      R1,#+10
   \   00000048   ........           BL       __aeabi_idivmod
   \   0000004C   0180A0E1           MOV      R8,R1
    381            int secHi = globalSeconds / 10;
   \   00000050   14B094E5           LDR      R11,[R4, #+20]
   \   00000054   0B00A0E1           MOV      R0,R11
   \   00000058   0A10A0E3           MOV      R1,#+10
   \   0000005C   ........           BL       __aeabi_idiv
   \   00000060   0090A0E1           MOV      R9,R0
    382            int secLo = globalSeconds % 10;
   \   00000064   0B00A0E1           MOV      R0,R11
   \   00000068   0A10A0E3           MOV      R1,#+10
   \   0000006C   ........           BL       __aeabi_idivmod
   \   00000070   01A0A0E1           MOV      R10,R1
    383            
    384            PIO_Clear(&pinLatch);
   \   00000074   ........           LDR      R11,??DataTable8_4
   \   00000078   A0008BE2           ADD      R0,R11,#+160
   \   0000007C   ........           BL       PIO_Clear
    385          
    386            writeByte(hoursLO[hourLo] + hoursHI[hourHi]*16);
   \   00000080   040086E0           ADD      R0,R6,R4
   \   00000084   2800D0E5           LDRB     R0,[R0, #+40]
   \   00000088   041085E0           ADD      R1,R5,R4
   \   0000008C   1810D1E5           LDRB     R1,[R1, #+24]
   \   00000090   010280E0           ADD      R0,R0,R1, LSL #+4
   \   00000094   FF0000E2           AND      R0,R0,#0xFF
   \   00000098   ........           BL       writeByte
    387            writeByte(minutesLO[minLo]*16 + minutesHI[minHi]);
   \   0000009C   040088E0           ADD      R0,R8,R4
   \   000000A0   4800D0E5           LDRB     R0,[R0, #+72]
   \   000000A4   041087E0           ADD      R1,R7,R4
   \   000000A8   3810D1E5           LDRB     R1,[R1, #+56]
   \   000000AC   000281E0           ADD      R0,R1,R0, LSL #+4
   \   000000B0   FF0000E2           AND      R0,R0,#0xFF
   \   000000B4   ........           BL       writeByte
    388            writeByte(secondsLO[secLo]*16 + secondsHI[secHi]);
   \   000000B8   04008AE0           ADD      R0,R10,R4
   \   000000BC   6800D0E5           LDRB     R0,[R0, #+104]
   \   000000C0   041089E0           ADD      R1,R9,R4
   \   000000C4   5810D1E5           LDRB     R1,[R1, #+88]
   \   000000C8   000281E0           ADD      R0,R1,R0, LSL #+4
   \   000000CC   FF0000E2           AND      R0,R0,#0xFF
   \   000000D0   ........           BL       writeByte
    389            
    390            PIO_Set(&pinLatch);
   \   000000D4   A0008BE2           ADD      R0,R11,#+160
   \   000000D8   F24FBDE8           POP      {R1,R4-R11,LR}
   \   000000DC   ........           B        PIO_Set          ;; tailcall
    391          }
    392          
    393          //------------------------------------------------------------------------------
    394          /// Initializes drivers and start the USB <-> Serial bridge.
    395          //------------------------------------------------------------------------------

   \                                 In section .text, align 4, keep-with-next
    396          int main()
    397          {
   \                     main:
   \   00000000   10402DE9           PUSH     {R4,LR}
   \   00000004   10D04DE2           SUB      SP,SP,#+16
    398              TRACE_CONFIGURE(DBGU_STANDARD, 115200, BOARD_MCK);
   \   00000008   ........           LDR      R4,??DataTable8_4
   \   0000000C   0D00A0E1           MOV      R0,SP
   \   00000010   0E00B4E8           LDM      R4!,{R1-R3}
   \   00000014   0E00A0E8           STM      R0!,{R1-R3}
   \   00000018   0C4044E2           SUB      R4,R4,#+12
   \   0000001C   0110A0E3           MOV      R1,#+1
   \   00000020   0D00A0E1           MOV      R0,SP
   \   00000024   ........           BL       PIO_Configure
   \   00000028   B727A0E3           MOV      R2,#+47972352
   \   0000002C   6C2C82E3           ORR      R2,R2,#0x6C00
   \   00000030   401BA0E3           MOV      R1,#+65536
   \   00000034   C21C81E3           ORR      R1,R1,#0xC200
   \   00000038   800EA0E3           MOV      R0,#+2048
   \   0000003C   ........           BL       DBGU_Configure
    399              printf("-- USB Device CDC Serial Project %s --\n\r", SOFTPACK_VERSION);
   \   00000040   381084E2           ADD      R1,R4,#+56
   \   00000044   0C0084E2           ADD      R0,R4,#+12
   \   00000048   ........           BL       printf
    400              printf("-- %s\n\r", BOARD_NAME);
   \   0000004C   481084E2           ADD      R1,R4,#+72
   \   00000050   400084E2           ADD      R0,R4,#+64
   \   00000054   ........           BL       printf
    401              printf("-- Compiled: %s %s --\n\r", __DATE__, __TIME__);
   \   00000058   7C2084E2           ADD      R2,R4,#+124
   \   0000005C   701084E2           ADD      R1,R4,#+112
   \   00000060   580084E2           ADD      R0,R4,#+88
   \   00000064   ........           BL       printf
    402          
    403              // If they are present, configure Vbus & Wake-up pins
    404              PIO_InitializeInterrupts(0);
   \   00000068   0000A0E3           MOV      R0,#+0
   \   0000006C   ........           BL       PIO_InitializeInterrupts
    405          
    406              LED_Configure(0);
   \   00000070   0000A0E3           MOV      R0,#+0
   \   00000074   ........           BL       LED_Configure
    407            
    408              PIO_Configure(&pinData, 1);
   \   00000078   0110A0E3           MOV      R1,#+1
   \   0000007C   880084E2           ADD      R0,R4,#+136
   \   00000080   ........           BL       PIO_Configure
    409              PIO_Configure(&pinClk, 1);
   \   00000084   0110A0E3           MOV      R1,#+1
   \   00000088   940084E2           ADD      R0,R4,#+148
   \   0000008C   ........           BL       PIO_Configure
    410              PIO_Configure(&pinLatch, 1);
   \   00000090   0110A0E3           MOV      R1,#+1
   \   00000094   A00084E2           ADD      R0,R4,#+160
   \   00000098   ........           BL       PIO_Configure
    411          
    412              InitUSART1();
   \   0000009C   ........           BL       InitUSART1
    413          
    414              isGPSCommand = 0;
   \   000000A0   ........           LDR      R0,??DataTable8_6
   \   000000A4   0010A0E3           MOV      R1,#+0
   \   000000A8   041080E5           STR      R1,[R0, #+4]
    415              
    416              int iii = 0;
                         ^
Warning[Pe177]: variable "iii" was declared but never referenced
    417              
    418              while (1) {
    419                  unsigned char token = read_char_USART1_nonstop();
   \                     ??main_0:
   \   000000AC   ........           BL       read_char_USART1_nonstop
   \   000000B0   0040A0E1           MOV      R4,R0
    420                  putchar(token);
   \   000000B4   ........           BL       putchar
    421                  if (token != 0) {
   \   000000B8   000054E3           CMP      R4,#+0
   \   000000BC   FAFFFF0A           BEQ      ??main_0
    422                      processChar(token);
   \   000000C0   0400A0E1           MOV      R0,R4
   \   000000C4   ........           BL       processChar
   \   000000C8   F7FFFFEA           B        ??main_0
    423                  }
    424              }
    425          /*
    426              PIO_Configure(&pinData, 1);
    427              PIO_Configure(&pinClk, 1);
    428              PIO_Configure(&pinLatch, 1);
    429            for (int i =0; i < 16;i++) {
    430              
    431              delay(5000);
    432              PIO_Clear(&pinLatch);
    433              delay(5000);
    434          
    435              writeByte(hoursLO[i] + hoursHI[i]*16);
    436              writeByte(minutesLO[i]*16 + minutesHI[i]);
    437              writeByte(secondsLO[i]*16 + secondsHI[i]);
    438          
    439              delay(5000000);
    440              
    441                  PIO_Set(&pinLatch);
    442            }
    443              */
    444          }

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8:
   \   00000000   1440FCFF           DC32     0xfffc4014

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_1:
   \   00000000   ........           DC32     `?<Constant "USART2_IrqHandler ENT...">`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_2:
   \   00000000   ........           DC32     pinsUsart1

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_3:
   \   00000000   0040FCFF           DC32     0xfffc4000

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_4:
   \   00000000   ........           DC32     `?<Constant {{1536, (AT91S_PIO *)4294964224, 2,`

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_5:
   \   00000000   ........           DC32     globalYear

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_6:
   \   00000000   ........           DC32     currentBufferIndex

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable8_7:
   \   00000000   ........           DC32     `?<Constant "time: %i:%i:%i %i.%i....">`

   \                                 In section .rodata, align 4
   \                     `?<Constant "USART2_IrqHandler ENT...">`:
   \   00000000   555341525432       DC8 "USART2_IrqHandler ENTERING\012\015"
   \              5F4972714861
   \              6E646C657220
   \              454E54455249
   \              4E470A0D00  
   \   0000001D   000000             DC8 0, 0, 0
   \   00000020   55532052780A       DC8 "US Rx\012\015"
   \              0D00        
   \   00000028   555341525432       DC8 "USART2_IrqHandler Restart USB read\012\015"
   \              5F4972714861
   \              6E646C657220
   \              526573746172
   \              742055534220
   \              726561640A0D
   \              00          
   \   0000004D   000000             DC8 0, 0, 0
   \   00000050   555341525432       DC8 "USART2_IrqHandler serialState=%i\012\015"
   \              5F4972714861
   \              6E646C657220
   \              73657269616C
   \              53746174653D
   \              25690A0D00  
   \   00000073   00                 DC8 0
   \   00000074   2D572D205553       DC8 "-W- USART1_IrqHandler: Overrun\012\015"
   \              415254315F49
   \              727148616E64
   \              6C65723A204F
   \              76657272756E
   \              0A0D00      
   \   00000095   000000             DC8 0, 0, 0
   \   00000098   2D572D205553       DC8 "-W- USART1_IrqHandler: Framing error\012\015"
   \              415254315F49
   \              727148616E64
   \              6C65723A2046
   \              72616D696E67
   \              206572726F72
   \              0A0D00      
   \   000000BF   00                 DC8 0

   \                                 In section .rodata, align 4
   \                     `?<Constant "time: %i:%i:%i %i.%i....">`:
   \   00000000   74696D653A20       DC8 "time: %i:%i:%i %i.%i.%i\012\015"
   \              25693A25693A
   \              25692025692E
   \              25692E25690A
   \              0D00        
   \   0000001A   0000               DC8 0, 0
   \   0000001C   636F72726563       DC8 "corrected time: %i:%i:%i %i.%i.%i\012\015"
   \              746564207469
   \              6D653A202569
   \              3A25693A2569
   \              2025692E2569
   \              2E25690A0D00
   \   00000040   2447505A4441       DC8 "$GPZDA"
   \              00          
   \   00000047   00                 DC8 0
    445          

   Maximum stack usage in bytes:

     Function                 .cstack
     --------                 -------
     DayOfWeek                    24
     InitUSART1                    8
     IsLeapYear                    8
     MonthDay                      8
     USART2_IrqHandler            16
     correctSummertime            24
     correctTimezone              24
     delay                         0
     extractTime                  56
     main                         24
     processChar                  16
     read_char_USART1_nonstop      0
     showTime                     40
     writeByte                    16


   Section sizes:

     Function/Label                         Bytes
     --------------                         -----
     pinsUsart1                               24
     pinData                                 172
     pinClk
     pinLatch
     globalYear                              120
     globalMonth
     globalDay
     globalHours
     globalMinutes
     globalSeconds
     hoursHI
     hoursLO
     minutesHI
     minutesLO
     secondsHI
     secondsLO
     delay                                    28
     USART2_IrqHandler                       108
     InitUSART1                              108
     ?Subroutine0                              8
     read_char_USART1_nonstop                 36
     currentBufferIndex                     1032
     isGPSCommand
     gpsBuffer
     writeByte                               140
     DayOfWeek                               140
     ?Subroutine1                              8
     IsLeapYear                               52
     MonthDay                                172
     correctSummertime                       256
     correctTimezone                         112
     processChar                             132
     extractTime                             532
     showTime                                224
     main                                    204
     ??DataTable8                              4
     ??DataTable8_1                            4
     ??DataTable8_2                            4
     ??DataTable8_3                            4
     ??DataTable8_4                            4
     ??DataTable8_5                            4
     ??DataTable8_6                            4
     ??DataTable8_7                            4
     ?<Constant "USART2_IrqHandler ENT...">  192
     ?<Constant "time: %i:%i:%i %i.%i....">   72

 
 1 032 bytes in section .bss
   120 bytes in section .data
   460 bytes in section .rodata
 2 292 bytes in section .text
 
 2 292 bytes of CODE  memory
   460 bytes of CONST memory
 1 152 bytes of DATA  memory

Errors: none
Warnings: 4
